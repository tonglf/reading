## 第 9 章  C/C++编程中其他问题

### 9.1 中文截断成乱码

**代码示例**

```cpp
const int MAX_LEN = 1024 * 1024;
string line, str;

while (getline(cin, line)) {
    str = line;
    if (line.length() > MAX_LEN)
        str = line.substr(0, MAX_LEN - 1);
    cout << str << endl;
}
```

**现象&后果**

上面代码的目的是对输入字符串做长度判断，当输入字符串过长时，会做截断处理。在程序运行时发现，当输入字符串中包含有汉字等宽字节字符时，截断操作可能会造成乱码。

**编程建议**
涉及字符串截断的操作，要考虑数据来源的编码格式，尤其是像UTF-8这种非定长的编码。



### 9.2 不必要的类型转换

**代码示例**

```cpp

```

**现象&后果**



**Bug分析**



**正确代码**

```cpp

```



### 9.3 不确定的函数参数赋值

**代码示例**

```cpp

```

**现象&后果**



**Bug分析**



**正确代码**

```cpp

```



### 9.4 epoll边沿触发模式下的陷阱

**代码示例**

```cpp

```

**现象&后果**



**Bug分析**



**正确代码**

```cpp

```



### 9.5 小结

本章所提到的几个例子算不上很常见，但这些都是在工程实践中真实碰到的，经验不够丰富的程序员在初次面对这些问题时也许不能给出很好的解决方案。编程就是一个经验逐步积累的过程：发现问题，解决，经验增加......如此反复循环，个人不断成长，最终让你成为一个优秀的程序员。